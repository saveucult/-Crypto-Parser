# -Crypto-Parser
Этот парсер предназначен для сбора уникальных Bitcoin-адресов из транзакций блоков в блокчейне Bitcoin. Он работает с несколькими потоками, чтобы оптимально использовать ресурсы процессора, и сохраняет адреса в локальной базе данных SQLite. Рассмотрим, как именно он функционирует.

Основные функции:
Создание базы данных (create_database):

Проверяет и создает базу данных bitcoin_addresses.db, где создается таблица addresses для хранения уникальных Bitcoin-адресов и таблица progress для отслеживания последнего обработанного блока. Если данных нет, записывается блок с id = 1.
Сохранение адреса в базу (save_address_to_db):

Если адрес соответствует формату Bitcoin-адреса (проверка регулярным выражением в validate_bitcoin_address), адрес записывается в таблицу addresses (при этом игнорируются дубликаты).
Проверка формата Bitcoin-адреса (validate_bitcoin_address):

Используется регулярное выражение для проверки, что адрес начинается с 1, 3 или bc1 и имеет правильную длину и допустимые символы.
Получение последнего обработанного блока (get_last_processed_block):

Функция загружает номер последнего обработанного блока из базы данных, чтобы избежать повторной обработки уже обработанных блоков.
Обновление последнего обработанного блока (update_last_processed_block):

Эта функция записывает в базу данных номер текущего блока, как только данные из него успешно обработаны.
Получение сессии с повторными попытками (get_session):

Создается сессия с механизмом повторных попыток (10 попыток), который пытается снова отправить запрос в случае ошибок сервера (коды 429, 500, 502, 503, 504).
Запрос данных блока и обработка (fetch_block_data):

Основная функция, которая выполняет HTTP-запрос к blockchain.info для получения данных блока по его номеру.
Если запрос успешен (статус 200), функция извлекает все уникальные Bitcoin-адреса из выходов транзакций и сохраняет их в базе.
При ошибке 429 (превышение лимита запросов) делает паузу перед повторной попыткой.
Функция также обрабатывает сетевые исключения с экспоненциальной задержкой благодаря библиотеке backoff.
Поток для обработки блока (worker):

Этот поток вызывает fetch_block_data для диапазона номеров блоков, получая сессию и итерируя по блоку данных.
Основная функция для запуска обработки (get_bitcoin_addresses):

Определяет диапазон блоков, который нужно обработать (начиная с последнего обработанного блока до текущего).
Дробит диапазон блоков на части и распределяет их между потоками, задействуя всю мощность процессора.
Основные особенности:
Многопоточность и блокировки: Многопроцессорность используется для ускорения работы с большим количеством блоков. multiprocessing.Lock() используется для обеспечения атомарности записи в базу.
Обработка ошибок: Используется несколько методов для повышения устойчивости к ошибкам, в частности, повторные попытки и экспоненциальные задержки.
Хранение состояния: Последний обработанный блок сохраняется в базе, что позволяет парсеру начать с места, где он остановился.
Этот парсер обеспечивает надёжный и эффективный способ сбора данных с блокчейна Bitcoin, защищая от повторного использования данных и минимизируя риск потери информации при сбоях.
